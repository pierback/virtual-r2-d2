!function(e){function t(t,r,i){"use strict";function o(e){k||(k=y.sizeToFill?T.font.split(/\b\d+px\b/i):y.font.split(/\b\d+px\b/i)),T.font=k[0]+e+"px"+k[1]}function n(){isNaN(y.lineHeight)?-1!==y.lineHeight.toString().indexOf("px")?z=parseInt(y.lineHeight):-1!==y.lineHeight.toString().indexOf("%")&&(z=parseInt(y.lineHeight)/100*D):z=D*y.lineHeight}function a(){if(y.sizeToFill){var e=r.trim().split(/\s+/).length,t=0;do l(++t);while(B>j&&I.join(" ").split(/\s+/).length==e);l(--t)}else s();y.justifyLines&&"auto"===y.lineBreak&&h(),w(),c(),g()}function l(e){o(e),z=e,s()}function s(){if(y.allowNewLine)for(var e=r.trim().split("\n"),t=0,i=0;t<e.length-1;t++)i+=e[t].trim().split(/\s+/).length,X.push(i);var o=r.trim().split(/\s+/);f(o),p(o),j=I.length*z}function f(e){var t,r,i,o;e.forEach(function(n,a){if(t="",r=T.measureText(n).width,r>H){for(var l=0;T.measureText(t+n[l]).width<=H&&l<n.length;l++)t+=n[l];i=n.slice(0,l),o=n.slice(l),e.splice(a,1,i,o)}})}function p(e){I=[];for(var t=0,r=0;t<e.length;r++)if(I[r]="","auto"===y.lineBreak){if(T.measureText(I[r]+e[t]).width>H)break;for(;T.measureText(I[r]+e[t]).width<=H&&t<e.length;)if(I[r]+=e[t]+" ",t++,y.allowNewLine)for(var i=0;i<X.length;i++)if(X[i]===t){r++,I[r]="";break}I[r]=I[r].trim()}else I[r]=e[t],t++}function h(){for(var e,t,r,i=0;i<I.length;i++)r=T.measureText(I[i]).width,(!e||r>e)&&(e=r,t=i);var o,n,a,l,s,f="â€Š";for(i=0;i<I.length;i++)if(i!==t&&(o=I[i].trim().split(/\s+/).length,!(1>=o))){I[i]=I[i].trim().split(/\s+/).join(f),n=T.measureText(f).width,a=(e-T.measureText(I[i]).width)/n,l=a/(o-1),s="";for(var p=0;l>p;p++)s+=f;I[i]=I[i].trim().split(f).join(s)}}function d(e,t,r){var i=T.measureText(e).width;switch(T.textAlign){case"center":t-=i/2;break;case"right":t-=i}T.beginPath(),T.moveTo(t,r),T.lineTo(t+i,r),T.stroke()}function g(){for(var e=0;e<I.length;e++)Y.y=parseInt(Y.y)+z,T.fillText(I[e],Y.x,Y.y),y.strokeText&&T.strokeText(I[e],Y.x,Y.y),"underline"===y.textDecoration.toLocaleLowerCase()&&d(I[e],Y.x,Y.y)}function c(){T.textAlign=y.textAlign,"center"==y.textAlign?Y.x=C/2:"right"==y.textAlign?Y.x=C-y.paddingX:Y.x=y.paddingX}function w(){"middle"==y.verticalAlign?Y.y=(E-j)/2:"bottom"==y.verticalAlign?Y.y=E-j-y.paddingY:Y.y=y.paddingY}function u(){if("string"!=typeof r)throw new TypeError("The second parameter must be a String.");if(isNaN(D))throw new TypeError('Cannot parse "font".');if(isNaN(z))throw new TypeError('Cannot parse "lineHeight".');if("left"!==y.textAlign.toLocaleLowerCase()&&"center"!==y.textAlign.toLocaleLowerCase()&&"right"!==y.textAlign.toLocaleLowerCase())throw new TypeError('Property "textAlign" must be set to either "left", "center", or "right".');if("top"!==y.verticalAlign.toLocaleLowerCase()&&"middle"!==y.verticalAlign.toLocaleLowerCase()&&"bottom"!==y.verticalAlign.toLocaleLowerCase())throw new TypeError('Property "verticalAlign" must be set to either "top", "middle", or "bottom".');if("boolean"!=typeof y.justifyLines)throw new TypeError('Property "justifyLines" must be a Boolean.');if(isNaN(y.paddingX))throw new TypeError('Property "paddingX" must be a Number.');if(isNaN(y.paddingY))throw new TypeError('Property "paddingY" must be a Number.');if("boolean"!=typeof y.fitParent)throw new TypeError('Property "fitParent" must be a Boolean.');if("auto"!==y.lineBreak.toLocaleLowerCase()&&"word"!==y.lineBreak.toLocaleLowerCase())throw new TypeError('Property "lineBreak" must be set to either "auto" or "word".');if("boolean"!=typeof y.sizeToFill)throw new TypeError('Property "sizeToFill" must be a Boolean.');if("boolean"!=typeof y.strokeText)throw new TypeError('Property "strokeText" must be a Boolean.');if("boolean"!=typeof y.renderHDPI)throw new TypeError('Property "renderHDPI" must be a Boolean.');if("none"!==y.textDecoration.toLocaleLowerCase()&&"underline"!==y.textDecoration.toLocaleLowerCase())throw new TypeError('Property "textDecoration" must be set to either "none" or "underline".')}var x={font:"18px Arial, sans-serif",sizeToFill:!1,lineHeight:1,allowNewLine:!0,lineBreak:"auto",textAlign:"left",verticalAlign:"top",justifyLines:!1,paddingX:0,paddingY:0,fitParent:!1,strokeText:!1,renderHDPI:!0,textDecoration:"none"},y={};for(var m in x)y[m]=i.hasOwnProperty(m)?i[m]:x[m];var T=t.getContext("2d");T.font=y.font,T.textBaseline="bottom";var b=1,v="undefined"!=typeof global?global.devicePixelRatio:e.devicePixelRatio;if(y.renderHDPI&&v>1){var L={};for(var m in T)L[m]=T[m];var P=t.width,A=t.height;b=v,t.width=P*b,t.height=A*b,t.style.width=P*b*.5+"px",t.style.height=A*b*.5+"px";for(var m in L)try{T[m]=L[m]}catch(N){}T.scale(b,b)}var k,C=(y.fitParent?t.parentNode.clientWidth:t.width)/b,E=(y.fitParent?t.parentNode.clientHeight:t.height)/b,H=C-2*y.paddingX,B=E-2*y.paddingY,D=y.font.match(/\d+(px|em|%)/g)?+y.font.match(/\d+(px|em|%)/g)[0].match(/\d+/g):18,j=0,I=[],X=[],Y={x:0,y:0},z=0;o(D),n(),u(),a()}"module"in e&&"exports"in module?module.exports=t:e.CanvasTextWrapper=t}(this);